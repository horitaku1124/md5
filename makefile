CC = gcc
CFLG = -c -g -pg -Wall -Wextra
CFLG2 = -O3 -c -Wall -Wextra
CFLG3 = -O3 -std=c99 -c -Wall -Wextra
LDFLG = -pg
SRC = main.c md5.c
SRC2 = main2.c md5.c
SRC3 = crack1.c md5.c
OBJ = $(SRC:.c=.o)
OBJ2= $(SRC2:.c=.o)
OBJ3= $(SRC3:.c=.o)
EXE = main
EXE2 = main2
EXE3 = crack1
EXE4 = main3
EXE2_1 = m2_main1
CRACK2_1 = m2_crack1

TEST_MAIN2=./tester.sh ${EXE2}
TEST_MAIN3=./tester.sh ${EXE4}
TEST_MAIN4=./tester.sh ${EXE2_1}

${EXE4}: md5
	${CC} ${CFLG} main3.c md5.c
	${CC} main3.o md5.o -pg -o main3

${EXE3}: md5 obj_crack
	${CC} crack1.o md5.o -pg -o crack1

${EXE2}: ${OBJ}
	${CC} ${CFLG} main2.c md5.c
	${CC} main2.o md5.o -pg -o main2

${EXE}: ${OBJ}
	${CC} ${OBJ} ${LDFLG} -o ${EXE}

${EXE2_1}: md5_2
	${CC} ${CFLG} ${EXE2_1}.c
	${CC} ${EXE2_1}.o md5_2.o  ${LDFLG} -o ${EXE2_1}

${CRACK2_1}: md5_2
	${CC} ${CFLG3} ${CRACK2_1}.c
	${CC} ${CRACK2_1}.o md5_2.o -o ${CRACK2_1}

${OBJ}: ${SRC}
	${CC} ${CFLG} $?

md5_2:
	${CC} ${CFLG2} md5_2.c
	
md5:
	${CC} ${CFLG} md5.c

obj_crack:
	${CC} ${CFLG} crack1.c

run:
	./${EXE}
 
clean:
	rm -f *.o *.out *.dump *.i.c *.stackdump ${EXE} ${EXE2} ${EXE3} ${EXE4} ${CRACK2_1} ${EXE2_1} crack1

test:  ${EXE2}
	${TEST_MAIN2} a 0cc175b9c0f1b6a831c399e269772661
	${TEST_MAIN2} abc 900150983cd24fb0d6963f7d28e17f72
	${TEST_MAIN2} aBg0 e03c7e0d92db165c6dce85d09fade8c0
	${TEST_MAIN2} "!#%0" ba4e3039000b75cdb787b18d2ea86d4b
	${TEST_MAIN2} Sy9cDeMK fcb2ca343b5b3751fb8b22ec146d4c2c
	${TEST_MAIN2} n3RPCF6ct/,kL!L.!, eabcbb8cde94de1081e1ccd549cad06c
	${TEST_MAIN2} 1234567890123456789012345678901234567890123456789012345 c9ccf168914a1bcfc3229f1948e67da0
	${TEST_MAIN2} 12345678901234567890123456789012345678901234567890123456 49f193adce178490e34d1b3a4ec0064c
	${TEST_MAIN2} 12345678901234567890123456789012345678901234567890123456789012345 823cc889fc7318dd33dde0654a80b70a
	${TEST_MAIN2} t8Wfnv5XWn2rwaVdYKPcEqFpJ2sXC848jS4DNkGU df0436859b91bddcdef409ff71b64e21


test2: ${EXE4}
	${TEST_MAIN3} a 0cc175b9c0f1b6a831c399e269772661
	${TEST_MAIN3} abc 900150983cd24fb0d6963f7d28e17f72
	${TEST_MAIN3} aBg0 e03c7e0d92db165c6dce85d09fade8c0
	${TEST_MAIN3} "!#%0" ba4e3039000b75cdb787b18d2ea86d4b
	${TEST_MAIN3} Sy9cDeMK fcb2ca343b5b3751fb8b22ec146d4c2c
	${TEST_MAIN3} n3RPCF6ct/,kL!L.!, eabcbb8cde94de1081e1ccd549cad06c
	${TEST_MAIN3} 1234567890123456789012345678901234567890123456789012345 c9ccf168914a1bcfc3229f1948e67da0
	${TEST_MAIN3} 12345678901234567890123456789012345678901234567890123456 49f193adce178490e34d1b3a4ec0064c
	${TEST_MAIN3} 12345678901234567890123456789012345678901234567890123456789012345 823cc889fc7318dd33dde0654a80b70a
	${TEST_MAIN3} t8Wfnv5XWn2rwaVdYKPcEqFpJ2sXC848jS4DNkGU df0436859b91bddcdef409ff71b64e21

	
test3: ${EXE2_1}
	${TEST_MAIN4} a 0cc175b9c0f1b6a831c399e269772661
	${TEST_MAIN4} abc 900150983cd24fb0d6963f7d28e17f72
	${TEST_MAIN4} aBg0 e03c7e0d92db165c6dce85d09fade8c0
	${TEST_MAIN4} "!#%0" ba4e3039000b75cdb787b18d2ea86d4b
	${TEST_MAIN4} Sy9cDeMK fcb2ca343b5b3751fb8b22ec146d4c2c
	${TEST_MAIN4} n3RPCF6ct/,kL!L.!, eabcbb8cde94de1081e1ccd549cad06c
	${TEST_MAIN4} 1234567890123456789012345678901234567890123456789012345 c9ccf168914a1bcfc3229f1948e67da0
	${TEST_MAIN4} 12345678901234567890123456789012345678901234567890123456 49f193adce178490e34d1b3a4ec0064c
	${TEST_MAIN4} 12345678901234567890123456789012345678901234567890123456789012345 823cc889fc7318dd33dde0654a80b70a
	${TEST_MAIN4} t8Wfnv5XWn2rwaVdYKPcEqFpJ2sXC848jS4DNkGU df0436859b91bddcdef409ff71b64e21
	
crack1_dump: ${EXE3}
	objdump -M intel -S ${EXE3} > ${EXE3}.dump
	

m1_crack1_dump:
	${CC} -p -pg ${CFLG2} md5_2.c
	${CC} -p -pg ${CFLG3} ${CRACK2_1}.c
	${CC} -p -pg ${CRACK2_1}.o md5_2.o -o ${CRACK2_1}
	cpp md5_2.c > _md5_2.i.c
	#cc -O3 -masm=intel -S _md5_2.i.c -o _md5_2.dump.s
	cc -O3 -S _md5_2.i.c -o _md5_2.dump.s
	as _md5_2.dump.s -o _md5_2.o
	objdump -M intel -S ${CRACK2_1} > ${CRACK2_1}.dump